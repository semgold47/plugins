(function(){
  "use strict";

  if(window.lampa_listener_extensions && window.imdb_vote_plugin) return;

  var style=document.createElement('style'),icons={menuIcon:{html:'⭐'}};
  style.textContent=".full-start-new__rate-line{display:flex!important;flex-wrap:wrap;gap:.4em;overflow-x:auto;white-space:nowrap;padding-bottom:.3125em}.full-start-new__rate-line.visible{opacity:1}.ratings-container{display:flex!important;flex-wrap:nowrap;gap:.4em}.full-start__rate{min-width:2.5em;display:flex!important;align-items:center;flex-shrink:0}.full-start__rate .source--name{min-width:2em;min-height:1.4em;display:inline-flex;align-items:center;justify-content:center;padding:0}.full-start__rate .source--name img,.full-start__rate .source--name svg{width:2em!important;height:1.4em!important}.full-start__rate.rate--tomatoes .source--name{font-size:1em;min-width:1.25em}.full-start__rate.rate--oscars{color:gold}.full-start__pg,.full-start__status{display:inline-block;margin-right:.625em}.full-start__rate>div:last-child{font-size:.7em;padding:0 .4em}.card__vote{border-radius: 0.5em; -webkit-border-radius: 0.5em; align-items: center; display: flex; flex-direction: column;padding: 0.1em 0.1em;}";document.head.appendChild(style);
    var icons = {
    tmdb: { html: '<img  width="24" <img src="data:image/png;base64,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" alt="themoviedb">', name: "TMDb" },
    imdb: { html: '<?xml version="1.0" encoding="utf-8"?><svg width="24" height="24" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 122.88 122.88" style="enable-background:new 0 0 122.88 122.88" xml:space="preserve"><style type="text/css"><![CDATA[	.st0{fill:#F5C518;}]]></style><g><path class="st0" d="M18.43,0h86.02c10.18,0,18.43,8.25,18.43,18.43v86.02c0,10.18-8.25,18.43-18.43,18.43H18.43 C8.25,122.88,0,114.63,0,104.45l0-86.02C0,8.25,8.25,0,18.43,0L18.43,0z"/><path d="M24.96,78.72V44.16h-9.6v34.56H24.96L24.96,78.72z M45.36,44.16L43.2,60.24L42,51.6l-1.2-7.44l-12,0v34.56h8.16v-22.8 l3.36,22.8h6l3.12-23.28v23.28h8.16V44.16H45.36L45.36,44.16z M61.44,78.72V44.16h14.88c3.6,0,6.24,2.64,6.24,6v22.56 c0,3.36-2.64,6-6.24,6H61.44L61.44,78.72z M72.72,50.4l-2.16-0.24v22.56c1.2,0,2.16-0.24,2.4-0.72c0.48-0.48,0.48-1.92,0.48-4.32 V54.24v-2.88L72.72,50.4L72.72,50.4L72.72,50.4z M100.56,52.8h0.72c3.36,0,6.24,2.64,6.24,6v13.92c0,3.36-2.88,6-6.24,6l-0.72,0 c-1.92,0-3.84-0.96-5.04-2.64l-0.48,2.16H86.4V44.16h9.12V55.2C96.72,53.76,98.64,52.8,100.56,52.8L100.56,52.8z M98.64,69.6v-8.16 L98.4,58.8c-0.24-0.48-0.96-0.72-1.44-0.72c-0.48,0-1.2,0.24-1.44,0.72v13.68c0.24,0.48,0.96,0.72,1.44,0.72 c0.48,0,1.44-0.24,1.44-0.72L98.64,69.6L98.64,69.6z"/></g></svg>', name: "IMDb" },
    kp: { html: '<svg width="24" height="24" viewBox="0 0 300 300" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="mask0_1_69" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="300" height="300"><circle cx="150" cy="150" r="150" fill="white"/></mask><g mask="url(#mask0_1_69)"><circle cx="150" cy="150" r="150" fill="black"/><path d="M300 45L145.26 127.827L225.9 45H181.2L126.3 121.203V45H89.9999V255H126.3V178.92L181.2 255H225.9L147.354 174.777L300 255V216L160.776 160.146L300 169.5V130.5L161.658 139.494L300 84V45Z" fill="url(#paint0_radial_1_69)"/></g><defs><radialGradient id="paint0_radial_1_69" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(89.9999 45) rotate(45) scale(296.985)"><stop offset="0.5" stop-color="#FF5500"/><stop offset="1" stop-color="#BBFF00"/></radialGradient></defs></svg>', name: "КиноПоиск" },
    tomatoes: { html: '<svg id="svg3390" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 138.75 141.25" width="24" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"> <metadata id="metadata3396">  <rdf:RDF>   <cc:Work rdf:about="">    <dc:format>image/svg+xml</dc:format>    <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/>    <dc:title/>   </cc:Work>  </rdf:RDF> </metadata> <g id="layer1" fill="#f93208">  <path id="path3412" d="m20.154 40.829c-28.149 27.622-13.657 61.011-5.734 71.931 35.254 41.954 92.792 25.339 111.89-5.9071 4.7608-8.2027 22.554-53.467-23.976-78.009z"/>  <path id="path3471" d="m39.613 39.265 4.7778-8.8607 28.406-5.0384 11.119 9.2082z"/> </g> <g id="layer2">  <path id="path3437" d="m39.436 8.5696 8.9682-5.2826 6.7569 15.479c3.7925-6.3226 13.79-16.316 24.939-4.6684-4.7281 1.2636-7.5161 3.8553-7.7397 8.4768 15.145-4.1697 31.343 3.2127 33.539 9.0911-10.951-4.314-27.695 10.377-41.771 2.334 0.009 15.045-12.617 16.636-19.902 17.076 2.077-4.996 5.591-9.994 1.474-14.987-7.618 8.171-13.874 10.668-33.17 4.668 4.876-1.679 14.843-11.39 24.448-11.425-6.775-2.467-12.29-2.087-17.814-1.475 2.917-3.961 12.149-15.197 28.625-8.476z" fill="#02902e"/> </g></svg>', name: "Rotten Tomatoes" },
    metacritic: {
      html: '<svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 88 88"><circle fill="#001B36" stroke="#FC0" stroke-width="4.6" cx="44" cy="44" r="41.6"/><path transform="translate(-10,-961) matrix(1.2756629,-1.3487733,1.3685717,1.2634987,-267.04706,1066.0743)" fill="#FFF"d="m126.73438,92.087002 5.05859,0 0,2.832031 c 1.80989-2.200501 3.96483-3.30076 6.46484-3.300781 1.32811,2.1e-5 2.48045,.273458 3.45703,.820312 .97655,.546895 1.77733,1.373717 2.40235,2.480469 .91144-1.106752 1.89451-1.933574 2.94922-2.480469 1.05466-0.546854 2.18096-0.820291 3.3789-0.820312 1.52341,2.1e-5 2.81247,.309265 3.86719,.927734 1.05466,.618509 1.84242,1.526711 2.36328,2.724609 .37757,.885434 .56637,2.317724 .56641,4.296875 l 0,13.26172-5.48828,0 0-11.85547 c-3e-5-2.057277-0.18883-3.385401-0.56641-3.984375-0.50784-0.781233-1.28909-1.171858-2.34375-1.171875-0.76825,1.7e-5-1.49091,.234392-2.16797,.703125-0.6771,.468766-1.16538,1.155614-1.46484,2.060547-0.2995,.904961-0.44924,2.333998-0.44922,4.287108 l 0,9.96094-5.48828,0 0-11.36719 c-2e-5-2.018214-0.0977-3.320296-0.29297-3.906248-0.19533-0.585922-0.49806-1.02212-0.9082-1.308594-0.41017-0.286442-0.96681-0.429671-1.66993-0.429688-0.84636,1.7e-5-1.60808,.227882-2.28515,.683594-0.6771,.455745-1.16212,1.113297-1.45508,1.972656-0.29298,.859389-0.43946,2.28517-0.43945,4.27734 l 0,10.07813-5.48828,0z"/></svg>',
      name: "Metacritic"
    },
    oscars: { html: '🏆', name: "Oscars" },
    menuIcon: {
      html: '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEeklEQVR4nO2dy4sdRRSHJ2JifAUNiaCJ/4D6F4S4ULIIuIiOIrgQFXeCCxeKogujYBInymBWgYAL0ZWaRSQiiuDOByZiBLNWxwg+ZxSCj/jJ0ZrQXLseXX3vPbcnvw9mM9V1qup8PVV9u6vvzM01AK4BngVOAr8hxoXl8kTI7dZmzpvJvwtYGVuTIsYyMN+W/L+jVcS4OXdeQph2dOZPn1/+nY7CvCR82GsCPnNqXMCJucT0s6N1tRadAXZGcrxiha10b0akiOZZAqaDBDgjAc5IgDMS4IwEOCMBzkiAMxLgjAQ4IwHOSIAzEuCMBDgjAc5IgDMS4IwEOCMBzkiAMxLgjAQ4IwFrVQCwATgAfAssAfvtd43y9cBCKLeffcDFHeKvH4n/vP0u0n7btvDTwFHgAeDqvuOZRQHWwVH2N8oPtpQf6BB/oaX+Qqb91IbYJ4BLa8dTSzTP0YLywHaWjLLUKP8ucmZeXhD7ssiLImcy7ef4BNhWM55aJikgWT+RhLsLYt/ZI36Or9sk5NqrJRq3b4O5+okEvF4Q+7Ue8Uv4GNjYZTy1ROP2bTBXPzH4s8CmRNyN4XWe2vilPN5lPLVE4/ZtMFc/M/h7EnH3pCqWtG/rDHALcCwR6ufm1VGuvVqicfs2mKtPmqOJuK+kKpa23zjuyUS4+7vG60o0bt8Gc/VJc7ZtGgIuCZeMUWoSlvhLeLOgvx8CP4arsi+AReCmoQsw7m2JeRsZKgXcGjn8dIf+NvkLOFTyQS3azxkQcKwl5ssTEnBl5PCVSgGrvJeTEO3nDAj4Hbhq5NbDT5MQMKb+xnhpqAJGF8HdFDCDAmw6unGoAo43jj8yUAHGi0MV8Aew2e6SAt/PqIC37NYFsN1OmMgxp4YqwHgQ2EUhDgK2N465PreYD1HAO8DhWRXQNc4QBfwJ/FB6sASMX0AnJGCAAoBNkcOXNQVNR0D1rYiuU2/x8V0Dde1IrNweK1L24aYqfqSvdinZxhsXooBD5Hm/Nn5LP59KtHPfhXgZejN5HqqNH8quCNNO7MxffSDTvBcV43j4EGbJf3stfBC7CPgm88V21/aIX8qjJeMp5OBgBISyxcRgPugpuISPSh/KF65XNwxNwI7EgB6esICvgOtKx1PAYlWeprAxK1oOrAuJaJt+tvWIX3Lm/y/5PeK929wuOW0BbVv59nUof6Sl/NWe8VML7mP2zLnjeFK3TxZzyZ+0gA2h00uRzbm58nVhx8KZ8CD+SHPbYsf4o/wKfGkP3e1Ss3m1Uzge26D7XNjf+nn4hkmLeQp4ITXnT02AKEMCnJEAZyTAGQlwRgKckQBnJMAZCXBGApyRAGckwBkJcEYCnJEAZyTAGQlwRgKckQBnJMAZCXBGApyRAGckwBkJcEYCnJEAZyRghgXE/qX5Tu9OrxUSr2MtW+HJmB0xcT41Ac9Mvh0R4WkTsDX1/ZxiYti7EFtW56j58FqQmA6W69tHF4r53FdFirFgOb4jtlpvAfba4hBexRGMBbvStJxabv+bdgL/AJMbblfhELaMAAAAAElFTkSuQmCC" alt="rating-icon"><style>.rating-icon { color: white; }</style>'
    }
  };

  var API_PARAMS={omdb_url:'https://www.omdbapi.com/',omdb_apikey:Lampa.Storage.get('omdb_api_key','574b7b0b')};
  var KP_API_KEY=Lampa.Storage.get('kp_api_key','');
  var CACHE_TIME=3*24*60*60*1e3,OMDB_CACHE='omdb_rating_cache',TMDB_ID_CACHE='tmdb_id_mapping',ratingCache={},currentCardData=null,updateTimeout=null;

  function getOmdbCache(id){var c=Lampa.Storage.get(OMDB_CACHE)||{},i=c[id];return i&&(new Date().getTime()-i.timestamp<CACHE_TIME)?i:null;}
  function saveOmdbCache(id,d){if(!d||(!d.rtRating&&!d.metacriticRating&&!d.oscars))return;var c=Lampa.Storage.get(OMDB_CACHE)||{};c[id]={rtRating:d.rtRating,metacriticRating:d.metacriticRating,oscars:d.oscars,timestamp:new Date().getTime()};Lampa.Storage.set(OMDB_CACHE,c);}
  function getTmdbIdCache(id,type){var c=Lampa.Storage.get(TMDB_ID_CACHE)||{},k=type+'_'+id,i=c[k];return i&&(new Date().getTime()-i.timestamp<CACHE_TIME)?i.imdb_id:null;}
  function saveTmdbIdCache(id,type,imdb){if(!imdb)return;var c=Lampa.Storage.get(TMDB_ID_CACHE)||{},k=type+'_'+id;c[k]={imdb_id:imdb,timestamp:new Date().getTime()};Lampa.Storage.set(TMDB_ID_CACHE,c);}
  function parseOscars(t){if(typeof t!=='string')return null;var m=t.match(/Won (\d+) Oscars?/i);return m&&m[1]?parseInt(m[1],10):null;}
  function getImdbIdFromTmdb(id,type,cb){if(!id)return cb(null);var ct=type==='movie'?'movie':'tv',cached=getTmdbIdCache(id,ct);if(cached)return cb(cached);var url='https://api.themoviedb.org/3/'+ct+'/'+id+'/external_ids?api_key='+(Lampa.TMDB?Lampa.TMDB.key():'');new Lampa.Reguest().silent(url,function(d){var i=d&&d.imdb_id?d.imdb_id:null;saveTmdbIdCache(id,ct,i);cb(i);},function(){cb(null);});}
  function getOMDbRatings(id,cb){var c=getOmdbCache(id);if(c)return cb(c);if(!id||id==='null'||id.indexOf('tt')!==0)return cb({rtRating:null,metacriticRating:null,oscars:null});var url=API_PARAMS.omdb_url+'?i='+encodeURIComponent(id)+'&apikey='+API_PARAMS.omdb_apikey;fetch(url).then(function(r){if(!r.ok)throw new Error('HTTP error');return r.json();}).then(function(d){if(d.Response==='False')return cb({rtRating:null,metacriticRating:null,oscars:null});var rt=null,mc=null;if(d.Ratings)for(var i=0;i<d.Ratings.length;i++){if(d.Ratings[i].Source==='Rotten Tomatoes')rt=d.Ratings[i].Value;else if(d.Ratings[i].Source==='Metacritic')mc=d.Ratings[i].Value;}var cleanRt=rt?rt.replace('%',''):null;var cleanMc=d.Metascore&&d.Metascore!=='N/A'?d.Metascore:mc?mc.replace('/100',''):null;var osc=parseOscars(d.Awards||'');var res={rtRating:cleanRt,metacriticRating:cleanMc,oscars:osc};saveOmdbCache(id,res);cb(res);}).catch(function(){cb({rtRating:null,metacriticRating:null,oscars:null});});}
  function getKinopoiskRatingByNormalizedCard(card,key,cb){var q=(card.original_title||card.title||'').replace(/[:\-–—]/g,' ').trim(),y='';if(card.release_date&&typeof card.release_date==='string')y=card.release_date.split('-')[0];if(!y||!key)return cb(null);var enc=encodeURIComponent(q),url='https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword='+enc;fetch(url,{method:'GET',headers:{'X-API-KEY':key,'Content-Type':'application/json'}}).then(function(r){if(!r.ok)throw new Error('HTTP error');return r.json();}).then(function(d){if(!d.films||!d.films.length)return cb(null);var best=null;for(var i=0;i<d.films.length;i++){var f=d.films[i];if(f.year&&String(f.year).indexOf(String(y))===0){best=f;break;}}if(!best||!best.filmId)return cb(null);var detail='https://kinopoiskapiunofficial.tech/api/v2.2/films/'+best.filmId;fetch(detail,{method:'GET',headers:{'X-API-KEY':key,'Content-Type':'application/json'}}).then(function(r){if(!r.ok)throw new Error('HTTP error');return r.json();}).then(function(fD){cb(fD.ratingKinopoisk||null);}).catch(function(){cb(null);});}).catch(function(){cb(null);});}

  function getRatingHtml(val,icon){return icon+val;}

  function updateRateLineIconsAndRates(data){
    if(updateTimeout)clearTimeout(updateTimeout);
    updateTimeout=setTimeout(function(){
      var line=$('.full-start-new__rate-line');if(!line.length)return;line.removeClass('visible');var cont=line.find('.ratings-container');if(!cont.length){cont=$('<div class="ratings-container"></div>');line.find('.full-start__rate').appendTo(cont);line.prepend(cont);}
      var sources=['tmdb','imdb','kp','rate--tomatoes','rate--metacritic'];for(var i=0;i<sources.length;i++){var s=sources[i],el=line.find('.full-start__rate.rate--'+s);if(el.length){var sName=el.children('.source--name');if(!sName.length)sName=el.children('div').eq(1).addClass('source--name');sName.html(icons[s].html);if(!cont.find(el).length)cont.append(el);}}
      cont.find('.rate--tomatoes,.rate--metacritic,.rate--oscars').remove();
      function addNewRatings(res){var newS=[{source:'tomatoes',value:res.rtRating?res.rtRating+'%':'—'},{source:'metacritic',value:res.metacriticRating||'—'}];for(var i=0;i<newS.length;i++){var ns=newS[i],nb=$('<div class="full-start__rate rate--'+ns.source+'"><div>'+ns.value+'</div><div class="source--name">'+icons[ns.source].html+'</div></div>');cont.append(nb);}if(res.oscars&&res.oscars>0){var ob=$('<div class="full-start__rate rate--oscars"><div>'+res.oscars+'</div><div class="source--name">'+icons['oscars'].html+'</div></div>');cont.prepend(ob);}line.addClass('visible');}
      var imdbId=data&&data.imdb_id&&data.imdb_id.indexOf('tt')===0?data.imdb_id:null;if(imdbId)getOMDbRatings(imdbId,addNewRatings);else if(data.tmdb_id){var type=data.name||data.original_name?'tv':'movie';getImdbIdFromTmdb(data.tmdb_id,type,function(newId){if(newId){data.imdb_id=newId;getOMDbRatings(newId,addNewRatings);}else addNewRatings({rtRating:null,metacriticRating:null,oscars:null});});}else addNewRatings({rtRating:null,metacriticRating:null,oscars:null});
      if((data.kp_rating===null||data.kp_rating===undefined)&&KP_API_KEY){getKinopoiskRatingByNormalizedCard(data,KP_API_KEY,function(kp){if(kp){var el=line.find('.full-start__rate.rate--kp div:first');if(el.length)el.text(parseFloat(kp).toFixed(1));}});}
    },200);
  }

function updateCardRating(card, data) { 
    var vote = card.find('.card__vote');
    if (!vote.length) return;
    var cur = vote.text();

    var useImdb = Lampa.Storage.get('use_imdb_rating', false);
    var useKp = Lampa.Storage.get('use_kp_rating', false);
    var useTomatoes = Lampa.Storage.get('use_tomatoes_rating', false);
    var useMetacritic = Lampa.Storage.get('use_metacritic_rating', false);
    var useTmdb = !useImdb && !useKp && !useTomatoes && !useMetacritic;

    if (useKp && data.kp_rating) {
        vote.html(getRatingHtml(data.kp_rating, icons['kp'].html));
    } else if (useImdb && data.imdb_rating) {
        vote.html(getRatingHtml(data.imdb_rating, icons['imdb'].html));
    } else if (useTomatoes || useMetacritic) {
        if (data.imdb_id && data.imdb_id.indexOf('tt') === 0) {
            getOMDbRatings(data.imdb_id, function(res) {
                if (useTomatoes && res.rtRating) {
                    vote.html(getRatingHtml(res.rtRating + '%', icons['tomatoes'].html));
                } else if (useMetacritic && res.metacriticRating) {
                    vote.html(getRatingHtml(res.metacriticRating, icons['metacritic'].html));
                } else {
                    vote.text(cur); // не добавляем TMDb
                }
            });
        } else if (data.tmdb_id) {
            var type = data.name || data.original_name ? 'tv' : 'movie';
            getImdbIdFromTmdb(data.tmdb_id, type, function(newId) {
                if (newId) {
                    data.imdb_id = newId;
                    getOMDbRatings(newId, function(res) {
                        if (useTomatoes && res.rtRating) {
                            vote.html(getRatingHtml(res.rtRating + '%', icons['tomatoes'].html));
                        } else if (useMetacritic && res.metacriticRating) {
                            vote.html(getRatingHtml(res.metacriticRating, icons['metacritic'].html));
                        } else {
                            vote.text(cur); // не добавляем TMDb
                        }
                    });
                } else {
                    vote.text(cur); // не добавляем TMDb
                }
            });
        } else {
            vote.text(cur); // не добавляем TMDb
        }
    } else if (useTmdb) {
        vote.html(getRatingHtml(data.tmdb_rating || cur, icons['tmdb'].html));
    }
}


  function updateAllRatings(){$('.card').each(function(i,c){updateCardRating($(c),$(c).data('card')||{});});}

  function initCardListener(){if(!window.lampa_listener_extensions){window.lampa_listener_extensions=true;Object.defineProperty(window.Lampa.Card.prototype,'build',{get:function(){return this._build;},set:function(v){this._build=function(){v.apply(this);Lampa.Listener.send('card',{type:'build',object:this});}.bind(this);}});}
    if(!window.imdb_vote_plugin){window.imdb_vote_plugin=true;Lampa.Listener.follow('card',function(e){if(e.type!=='build')return;currentCardData=e.object.data;updateCardRating($(e.object.card),currentCardData);});}
  }

  function handleFullEvent(e){if(e.type==='complite'&&e.data&&e.data.movie){currentCardData=e.data.movie;updateRateLineIconsAndRates(currentCardData);updateAllRatings();}}
  function initFullContentListener(){Lampa.Listener.follow('full',handleFullEvent);}
  function start(){if(!window.Lampa||!window.Lampa.Listener||!window.Lampa.Card)return;initCardListener();initFullContentListener();}
  if(window.appready)start();else Lampa.Listener.follow('app',function(e){if(e.type==='ready')start();});

  Lampa.SettingsApi.addComponent({component:'rating_info',name:'Рейтинг',icon:icons.menuIcon.html});
  Lampa.SettingsApi.addParam({component:'rating_info',param:{name:'rating',type:'select',values:{tmdb:'TMDb ⚪',imdb:'IMDb 🔵',kp:'КиноПоиск 🟡',tomatoes:'Rotten Tomatoes 🍅',metacritic:'Metacritic 🟢'},default:'tmdb'},field:{name:'Источник рейтинга',description:'Выберите предпочитаемый источник рейтингов'},onChange:function(v){Lampa.Storage.set('use_imdb_rating',v==='imdb');Lampa.Storage.set('use_kp_rating',v==='kp');Lampa.Storage.set('use_tomatoes_rating',v==='tomatoes');Lampa.Storage.set('use_metacritic_rating',v==='metacritic');updateAllRatings();}});
  Lampa.SettingsApi.addParam({component:'rating_info',param:{name:'omdb_api_key',type:'input',values:'',placeholder:'Введите API ключ OMDB',default:''},field:{name:'Введите API ключ OMDB',description:'API ключ для OMDB (Rotten Tomatoes, Metacritic)'},onChange:function(v){if(v){Lampa.Storage.set('omdb_api_key',v);API_PARAMS.omdb_apikey=v;}}});
  Lampa.SettingsApi.addParam({component:'rating_info',param:{name:'kp_api_key',type:'input',values:'',placeholder:'Введите API ключ КиноПоиска',default:''},field:{name:'Введите API ключ КиноПоиска',description:'API ключ для КиноПоиск API'},onChange:function(v){if(v){Lampa.Storage.set('kp_api_key',v);KP_API_KEY=v;}}});
})();








